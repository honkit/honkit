# Copilot Instructions for HonKit

This repository contains HonKit, a modern book publishing platform built with Node.js and TypeScript. Follow these guidelines when working with this codebase.

## Repository Structure

HonKit uses a monorepo structure managed by Lerna:
- `packages/*` - Core packages and plugins
- `packages/@honkit/*` - Scoped packages
- `examples/*` - Example implementations
- `docs/` - Documentation

## Development Setup

- **Package Manager**: Use `pnpm` exclusively
- **Node.js**: Check `.node-version` for required version
- **Build System**: Lerna manages the monorepo
- **Installation**: Run `pnpm install` to install and build all packages

## Code Style & Standards

### Language & Formatting
- **TypeScript**: Preferred for new code
- **Formatter**: Prettier (configured in `prettier.config.mjs`)
- **Linting**: ESLint (configured in `eslint.config.mjs`)
- **Editor**: EditorConfig settings in `.editorconfig`

### Commit Messages
Follow Angular Convention format:
```
type(scope): description

body (optional)

footer (optional)
```

**Types**: `feat`, `fix`, `docs`, `style`, `perf`, `test`, `chore`, `refactor`

Examples:
- `feat(parser): add support for new markdown syntax`
- `fix(build): resolve TypeScript compilation errors`
- `docs(readme): update installation instructions`

## Development Guidelines

### Making Changes
1. Create feature branches from `master`
2. Keep changes focused and atomic
3. Update tests for any new functionality
4. Update documentation as needed
5. Follow existing code patterns and conventions

### Testing
- Run `pnpm test` for all packages
- Run package-level tests: `cd packages/PACKAGE && pnpm test`
- Ensure all tests pass before submitting changes
- Add tests for new features and bug fixes

### Building
- Run `pnpm run build` to build all packages
- Individual package builds: `cd packages/PACKAGE && pnpm run build`
- Clean builds: `pnpm run clean` then rebuild

### Pull Requests
- Use descriptive titles and clear descriptions
- Reference related issues
- Ensure CI passes
- Update documentation for user-facing changes
- Follow the existing code review process

## Project-Specific Guidelines

### Package Management
- Never modify `package-lock.json` manually
- Use workspace protocol (`workspace:*`) for internal dependencies
- Add new dependencies at the appropriate package level

### Documentation
- Update relevant documentation in `docs/` for user-facing changes
- Use clear, concise language
- Include code examples where helpful
- Maintain existing documentation structure

### Architecture
- Follow existing patterns for plugin architecture
- Maintain backward compatibility when possible
- Consider performance implications for book generation
- Use appropriate abstractions for different output formats

## Security & Safety

- Never commit secrets, API keys, or credentials
- Sanitize user inputs in markdown processing
- Be cautious with file system operations
- Follow security best practices for dependency management
- Report security issues privately to maintainers

## Common Tasks

### Adding New Packages
1. Create package directory under `packages/`
2. Use consistent `package.json` structure
3. Add appropriate build scripts
4. Update root workspace configuration if needed

### Plugin Development
- Follow existing plugin patterns
- Provide comprehensive documentation
- Include examples and tests
- Ensure compatibility with core HonKit versions

### Documentation Updates
- Edit files in `docs/` directory
- Test documentation builds locally
- Keep examples current and functional
- Maintain consistency with existing style

## Resources

- See [CONTRIBUTING.md](./CONTRIBUTING.md) for detailed contribution guidelines
- Check existing packages for implementation patterns
- Review issue templates for bug reports and feature requests
- Refer to docs for user-facing functionality

## Notes for AI Assistants

- Prioritize backward compatibility
- Be explicit about breaking changes
- Consider the impact on existing books and workflows
- Maintain the project's focus on simplicity and reliability
- When in doubt, follow existing patterns in the codebase